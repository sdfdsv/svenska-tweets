var options={gridSize:Math.round(16*$("#wordcloud").width()/1e3),weightFactor:function(a){return Math.pow(a,1)*$("#wordcloud").width()/100},fontFamily:"Times, serif",hover:function(a,b){b&&($("#infoDiv").prop("hidden",!1),$("#infoDiv").html("<strong>Selected word: </strong>"+a[0]))}};$(document).ready(function(){function a(){var a=$("#canvasDiv").width();d.attr("width",a),d.attr("height",.62*a),g(c)}function b(){var a=$("#wordCountTable tbody");c.forEach(function(b){var c=$("<tr></tr>");c.append("<td>"+b[0]+"</td><td>"+b[1]+"</td>"),b[1]<5&&c.addClass("hiddenRow"),a.append(c)})}var c,d=$("#wordcloud");$(window).resize(a);var e=function(a){words=a.toLowerCase().replace(/[^a-zåäö\-]/g," ").split(" "),hist={};for(c in words)words[c].length>1&&(hist[words[c]]?hist[words[c]]+=1:hist[words[c]]=1);var b=[];for(var c in hist)hist[c]>1&&b.push([c,hist[c]]);return b.sort(function(a,b){return b[1]-a[1]}),b},f=function(){$.ajax({url:"http://svenska-tweets.herokuapp.com/1.1/search/tweets.json?q=lang%3Asv&count=100",dataType:"jsonp",success:function(d){console.log(d);var f="";$.each(d.statuses,function(){f+=this.text+" "}),console.log(e(f)),c=e(f),b(),a()}})},g=function(a){options.list=a,WordCloud(document.getElementById("wordcloud"),options)},h=function(){$(".hiddenRow").toggleClass("hiddenRow")};$("#redrawBtn").click(a),$("#tableToggleBtn").click(h),f()}),window.setImmediate||(window.setImmediate=function(){return window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null;var a=[void 0],b="zero-timeout-message",c=function(c){var d=a.length;return a.push(c),window.postMessage(b+d.toString(36),"*"),d};return window.addEventListener("message",function(c){if("string"==typeof c.data&&c.data.substr(0,b.length)===b){c.stopImmediatePropagation();var d=parseInt(c.data.substr(b.length),36);a[d]&&(a[d](),a[d]=void 0)}},!0),window.clearImmediate=function(b){a[b]&&(a[b]=void 0)},c}()||function(a){window.setTimeout(a,0)}}()),window.clearImmediate||(window.clearImmediate=function(){return window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(a){window.clearTimeout(a)}}()),function(a){var b=function(){var a=document.createElement("canvas");if(!a||!a.getContext)return!1;var b=a.getContext("2d");return b.getImageData&&b.fillText&&Array.prototype.some&&Array.prototype.push?!0:!1}(),c=function(){if(b){for(var a,c,d=document.createElement("canvas").getContext("2d"),e=20;e;){if(d.font=e.toString(10)+"px sans-serif",d.measureText("Ｗ").width===a&&d.measureText("m").width===c)return e+1;a=d.measureText("Ｗ").width,c=d.measureText("m").width,e--}return 0}}(),d=function(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},e=function(a,e){if(b){Array.isArray(a)||(a=[a]),a.forEach(function(b,c){if("string"==typeof b){if(a[c]=document.getElementById(b),!a[c])throw"The element id specified is not found."}else if(!b.tagName&&!b.appendChild)throw"You must pass valid HTML elements, or ID of the element."});var f={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,hover:null,click:null};if(e)for(var g in e)g in f&&(f[g]=e[g]);if("function"!=typeof f.weightFactor){var h=f.weightFactor;f.weightFactor=function(a){return a*h}}if("function"!=typeof f.shape)switch(f.shape){case"circle":default:f.shape="circle";break;case"cardioid":f.shape=function(a){return 1-Math.sin(a)};break;case"diamond":case"square":f.shape=function(a){var b=a%(2*Math.PI/4);return 1/(Math.cos(b)+Math.sin(b))};break;case"triangle-forward":f.shape=function(a){var b=a%(2*Math.PI/3);return 1/(Math.cos(b)+Math.sqrt(3)*Math.sin(b))};break;case"triangle":case"triangle-upright":f.shape=function(a){var b=(a+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(b)+Math.sqrt(3)*Math.sin(b))};break;case"pentagon":f.shape=function(a){var b=(a+.955)%(2*Math.PI/5);return 1/(Math.cos(b)+.726543*Math.sin(b))};break;case"star":f.shape=function(a){var b=(a+.955)%(2*Math.PI/10);return(a+.955)%(2*Math.PI/5)-2*Math.PI/10>=0?1/(Math.cos(2*Math.PI/10-b)+3.07768*Math.sin(2*Math.PI/10-b)):1/(Math.cos(b)+3.07768*Math.sin(b))}}f.gridSize=Math.max(f.gridSize,4);var i,j,k,l,m,n,o,p=f.gridSize,q=p-f.maskGapWidth,r=Math.abs(f.maxRotation-f.minRotation),s=Math.min(f.maxRotation,f.minRotation);switch(f.color){case"random-dark":o=function(){return"rgb("+Math.floor(128*Math.random()).toString(10)+","+Math.floor(128*Math.random()).toString(10)+","+Math.floor(128*Math.random()).toString(10)+")"};break;case"random-light":o=function(){return"rgb("+Math.floor(128*Math.random()+128).toString(10)+","+Math.floor(128*Math.random()+128).toString(10)+","+Math.floor(128*Math.random()+128).toString(10)+")"};break;default:"function"==typeof f.color&&(o=f.color)}var t,u=!1,v=[],w=function(a){var b=a.target,c=b.getBoundingClientRect(),d=a.clientX-c.left,e=a.clientY-c.top,f=Math.floor(d*(b.width/c.width)/p),g=Math.floor(e*(b.height/c.height)/p);return v[f][g]},x=function(a){var b=w(a);if(t!==b)return t=b,b?void f.hover(b.item,b.dimension,a):void f.hover(void 0,void 0,a)},y=function(a){var b=w(a);b&&f.click(b.item,b.dimension,a)},z=[],A=function(a){if(z[a])return z[a];var b=8*a,c=b,d=[];for(0===a&&d.push([l[0],l[1],0]);c--;){var e=1;"circle"!==f.shape&&(e=f.shape(c/b*2*Math.PI)),d.push([l[0]+a*e*Math.cos(-c/b*2*Math.PI),l[1]+a*e*Math.sin(-c/b*2*Math.PI)*f.ellipticity,c/b*2*Math.PI])}return z[a]=d,d},B=function(){return f.abortThreshold>0&&(new Date).getTime()-n>f.abortThreshold},C=function(){return 0===f.rotateRatio?0:Math.random()>f.rotateRatio?0:0===r?s:s+Math.random()*r},D=function(a,b,d){var e=!1,g=f.weightFactor(b);if(g<=f.minSize)return!1;var h=1;c>g&&(h=function(){for(var a=2;c>a*g;)a+=2;return a}());var i=document.createElement("canvas"),j=i.getContext("2d",{willReadFrequently:!0});j.font=f.fontWeight+" "+(g*h).toString(10)+"px "+f.fontFamily;var k=j.measureText(a).width/h,l=Math.max(g*h,j.measureText("m").width,j.measureText("Ｗ").width)/h,m=k+2*l,n=3*l,o=Math.ceil(m/p),q=Math.ceil(n/p);m=o*p,n=q*p;var r=-k/2,s=.4*-l,t=Math.ceil((m*Math.abs(Math.sin(d))+n*Math.abs(Math.cos(d)))/p),u=Math.ceil((m*Math.abs(Math.cos(d))+n*Math.abs(Math.sin(d)))/p),v=u*p,w=t*p;i.setAttribute("width",v),i.setAttribute("height",w),e&&(document.body.appendChild(i),j.save()),j.scale(1/h,1/h),j.translate(v*h/2,w*h/2),j.rotate(-d),j.font=f.fontWeight+" "+(g*h).toString(10)+"px "+f.fontFamily,j.fillStyle="#000",j.textBaseline="middle",j.fillText(a,r*h,(s+.5*g)*h);var x=j.getImageData(0,0,v,w).data;if(B())return!1;e&&(j.strokeRect(r*h,s,k*h,l*h),j.restore());for(var y,z,A,C=[],D=u,E=[t/2,u/2,t/2,u/2];D--;)for(y=t;y--;){A=p;a:{for(;A--;)for(z=p;z--;)if(x[4*((y*p+A)*v+(D*p+z))+3]){C.push([D,y]),D<E[3]&&(E[3]=D),D>E[1]&&(E[1]=D),y<E[0]&&(E[0]=y),y>E[2]&&(E[2]=y),e&&(j.fillStyle="rgba(255, 0, 0, 0.5)",j.fillRect(D*p,y*p,p-.5,p-.5));break a}e&&(j.fillStyle="rgba(0, 0, 255, 0.5)",j.fillRect(D*p,y*p,p-.5,p-.5))}}return e&&(j.fillStyle="rgba(0, 255, 0, 0.5)",j.fillRect(E[3]*p,E[0]*p,(E[1]-E[3]+1)*p,(E[2]-E[0]+1)*p)),{mu:h,occupied:C,bounds:E,gw:u,gh:t,fillTextOffsetX:r,fillTextOffsetY:s,fillTextWidth:k,fillTextHeight:l,fontSize:g}},E=function(a,b,c,d,e){for(var f=e.length;f--;){var g=a+e[f][0],h=b+e[f][1];if(g>=j||h>=k||0>g||0>h||!i[g][h])return!1}return!0},F=function(b,c,d,e,g,h,i,j,k){var l,m=d.fontSize;l=o?o(e,g,m,h,i):f.color;var n,q=d.bounds;n={x:(b+q[3])*p,y:(c+q[0])*p,w:(q[1]-q[3]+1)*p,h:(q[2]-q[0]+1)*p},a.forEach(function(a){if(a.getContext){var g=a.getContext("2d"),h=d.mu;g.save(),g.scale(1/h,1/h),g.font=f.fontWeight+" "+(m*h).toString(10)+"px "+f.fontFamily,g.fillStyle=l,g.translate((b+d.gw/2)*p*h,(c+d.gh/2)*p*h),0!==j&&g.rotate(-j),g.textBaseline="middle",g.fillText(e,d.fillTextOffsetX*h,(d.fillTextOffsetY+.5*m)*h),g.restore()}else{var i=document.createElement("span"),n="";n="rotate("+-j/Math.PI*180+"deg) ",1!==d.mu&&(n+="translateX(-"+d.fillTextWidth/4+"px) scale("+1/d.mu+")");var o={position:"absolute",display:"block",font:f.fontWeight+" "+m*d.mu+"px "+f.fontFamily,left:(b+d.gw/2)*p+d.fillTextOffsetX+"px",top:(c+d.gh/2)*p+d.fillTextOffsetY+"px",width:d.fillTextWidth+"px",height:d.fillTextHeight+"px",color:l,lineHeight:m+"px",whiteSpace:"nowrap",transform:n,webkitTransform:n,msTransform:n,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"};i.textContent=e;for(var q in o)i.style[q]=o[q];if(k)for(var r in k)i.setAttribute(r,k[r]);a.appendChild(i)}})},G=function(b,c,d,e,f){if(!(b>=j||c>=k||0>b||0>c)){if(i[b][c]=!1,d){var g=a[0].getContext("2d");g.fillRect(b*p,c*p,q,q)}u&&(v[b][c]={item:f,dimension:e})}},H=function(b,c,d,e,g,h){var i,j=g.occupied,k=f.drawMask;k&&(i=a[0].getContext("2d"),i.save(),i.fillStyle=f.maskColor);var l;if(u){var m=g.bounds;l={x:(b+m[3])*p,y:(c+m[0])*p,w:(m[1]-m[3]+1)*p,h:(m[2]-m[0]+1)*p}}for(var n=j.length;n--;)G(b+j[n][0],c+j[n][1],k,l,h);k&&i.restore()},I=function(a){var b,c,e;Array.isArray(a)?(b=a[0],c=a[1]):(b=a.word,c=a.weight,e=a.attributes);var g=C(),h=D(b,c,g);if(!h)return!1;if(B())return!1;var i=h.bounds;if(i[1]-i[3]+1>j||i[2]-i[0]+1>k)return!1;for(var l=m+1,n=function(d){var f=Math.floor(d[0]-h.gw/2),i=Math.floor(d[1]-h.gh/2),j=h.gw,k=h.gh;return E(f,i,j,k,h.occupied)?(F(f,i,h,b,c,m-l,d[2],g,e),H(f,i,j,k,h,a),!0):!1};l--;){var o=A(m-l);f.shuffle&&(o=[].concat(o),d(o));var p=o.some(n);if(p)return!0}return!1},J=function(b,c,d){return c?!a.some(function(a){var e=document.createEvent("CustomEvent");return e.initCustomEvent(b,!0,c,d||{}),!a.dispatchEvent(e)},this):void a.forEach(function(a){var e=document.createEvent("CustomEvent");e.initCustomEvent(b,!0,c,d||{}),a.dispatchEvent(e)},this)},K=function(){var b=a[0];if(b.getContext)j=Math.floor(b.width/p),k=Math.floor(b.height/p);else{var c=b.getBoundingClientRect();j=Math.floor(c.width/p),k=Math.floor(c.height/p)}if(J("wordcloudstart",!0)){l=f.origin?[f.origin[0]/p,f.origin[1]/p]:[j/2,k/2],m=Math.floor(Math.sqrt(j*j+k*k)),i=[];var d,e,g;if(!b.getContext||f.clearCanvas)for(a.forEach(function(a){if(a.getContext){var b=a.getContext("2d");b.fillStyle=f.backgroundColor,b.clearRect(0,0,j*(p+1),k*(p+1)),b.fillRect(0,0,j*(p+1),k*(p+1))}else a.textContent="",a.style.backgroundColor=f.backgroundColor}),d=j;d--;)for(i[d]=[],e=k;e--;)i[d][e]=!0;else{var h=document.createElement("canvas").getContext("2d");h.fillStyle=f.backgroundColor,h.fillRect(0,0,1,1);var o=h.getImageData(0,0,1,1).data,q=b.getContext("2d").getImageData(0,0,j*p,k*p).data;d=j;for(var r,s;d--;)for(i[d]=[],e=k;e--;){s=p;a:for(;s--;)for(r=p;r--;)for(g=4;g--;)if(q[4*((e*p+s)*j*p+(d*p+r))+g]!==o[g]){i[d][e]=!1;break a}i[d][e]!==!1&&(i[d][e]=!0)}q=h=o=void 0}if(f.hover||f.click){for(u=!0,d=j+1;d--;)v[d]=[];f.hover&&b.addEventListener("mousemove",x),f.click&&b.addEventListener("click",y),b.addEventListener("wordcloudstart",function F(){b.removeEventListener("wordcloudstart",F),b.removeEventListener("mousemove",x),b.removeEventListener("click",y),t=void 0})}g=0;var w,z;0!==f.wait?(w=window.setTimeout,z=window.clearTimeout):(w=window.setImmediate,z=window.clearImmediate);var A=function(b,c){a.forEach(function(a){a.addEventListener(b,c)},this)},C=function(b,c){a.forEach(function(a){a.removeEventListener(b,c)},this)},D=function G(){C("wordcloudstart",G),z(E)};A("wordcloudstart",D);var E=w(function H(){if(g>=f.list.length)return z(E),J("wordcloudstop",!1),void C("wordcloudstart",D);n=(new Date).getTime();var a=I(f.list[g]),b=!J("wordclouddrawn",!0,{item:f.list[g],drawn:a});return B()||b?(z(E),f.abort(),J("wordcloudabort",!1),J("wordcloudstop",!1),void C("wordcloudstart",D)):(g++,void(E=w(H,f.wait)))},f.wait)}};K()}};e.isSupported=b,e.miniumFontSize=c,"function"==typeof a.define&&a.define.amd?a.define("wordcloud",[],function(){return e}):a.WordCloud=e}(window);